---
title: "case_study1"
output: html_document
date: "2025-10-07"
---

Loading libraries and reading in the dataset:

```{r}
library(p8105.datasets)
library(tidyverse)
library(leaflet)

data(nyc_airbnb)
```

## Brainstorm questions

*Pick a neighborhood / borough, investigate price?
  *If we had dates, does that affect price?
*Does the tupe of unit affect rating/price?
*What about ZIP codes?
*What rental has the highest reviews?
*Are there any connections between price and other variables?
*What about prices over time?
  *Could we look at prices before and after the pandemic?
*How else did the pandemic affect AirBNB in NYC?
*Does the name of the rental affect price/rating?
*What does the number of days available have to do with anything else?


I am going to try to answer: Does the name of the rental affect price/rating?

Maybe I will investigate price where the name contains 'spacious' vs. 'cozy'!

```{r}
nyc_airbnb |> 
  mutate(
    group = case_when(
      str_detect(str_to_lower(name), "spacious") ~ "Spacious",
      str_detect(str_to_lower(name), "cozy") ~ "Cozy",
      TRUE ~ "Other"
    )
  ) |> 
  group_by(group) |> 
  mutate(
    mean_price = mean(price, na.rm = TRUE)
  ) |> 
  ggplot(aes(x = group, y = price, fill = group)) + 
  geom_violin() +
  theme_minimal() +
  labs(
    x = "",
    y = "Price (USD)",
    title = "Distribution of Airbnb Prices by Name Key Words",
    caption = "Grouped by whether the name includes 'Spacious' or 'Cozy'"
  ) +
  coord_cartesian(ylim = c(0, 500))


```


Let's look at prices

```{r}
nyc_airbnb |> 
  drop_na(price) |> 
  group_by(room_type, neighbourhood_group) |> 
  summarize(
    mean_price = mean(price)) |> 
  pivot_wider(
    names_from = room_type,
    values_from = mean_price
  )
```

make some plots

```{r}
nyc_airbnb |> 
  ggplot() +
  geom_histogram(aes(x = price)) +
  facet_grid(room_type ~ neighbourhood_group) +
  scale_x_continuous(limits = c(0,1000))
```



```{r}
nyc_airbnb |> 
  filter(
    neighbourhood_group == "Manhattan",
    price < 500,
    room_type =="Entire home/apt") |> 
  mutate(neighbourhood = fct_reorder(neighbourhood, price)) |> #put in order from lowest to highest price
  ggplot(aes(x = neighbourhood, y = price)) +
  geom_violin() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5))
```


remember to look at extreme values

```{r}
nyc_airbnb |> 
  filter(price > 9000)
```

```{r}
nyc_airbnb |> 
  filter(calculated_host_listings_count > 30) |> view()
```

keep looking at location

```{r}
nyc_airbnb |> 
  filter(
    neighbourhood_group == "Manhattan",
    price < 1000,
    room_type =="Entire home/apt") |> 
  ggplot(aes(x = lat, y = long, color = price)) +
  geom_point()
```

can we make a better map?

```{r}
pal <- colorNumeric(
  palette = "viridis",
  domain = nyc_airbnb$review_scores_location
)

nyc_airbnb |> 
  filter(
    neighbourhood_group == "Manhattan",
    price < 1000,
    room_type =="Entire home/apt") |>
  sample_n(2000) |>  #random sample of 25 of the observations so it's less crazy
  leaflet() |> #leaflet helps you make maps!! Looks really cool!
  addProviderTiles(providers$CartoDB.Positron) |> 
  addCircleMarkers(
    ~lat, ~long,
    color = ~pal(review_scores_location),
    radius = 2)
```




